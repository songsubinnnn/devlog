<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Devlog</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<div class="container">
  <div class="header">
    <h1 th:text="${isEdit}? 'âœï¸ ê²Œì‹œê¸€ ìˆ˜ì •' : 'âœï¸ ìƒˆ ê²Œì‹œê¸€'">âœï¸ ìƒˆ ê²Œì‹œê¸€</h1>
    <p>ë‹¹ì‹ ì˜ ì—¬ì •ì„ ê¸°ë¡í•´ë³´ì„¸ìš”</p>
  </div>

  <div class="form-container">
    <form id="postForm" th:action="${isEdit} ? @{/posts/{id}(id=${postDTO.id})} : @{/posts}"
          enctype="multipart/form-data" th:object="${postDTO}" method="post">

      <input type="hidden" id="id" name="id" th:value="${postDTO.id}"/>

      <div class="form-group">
        <label for="title">ğŸ“ ì œëª©</label>
        <input type="text" id="title" name="title" th:field="*{title}"
               class="form-input" placeholder="ë©‹ì§„ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." required>
      </div>

      <div class="form-group">
        <label for="content">ğŸ“„ ë³¸ë¬¸</label>
        <textarea id="content" name="content" th:field="*{content}"
                  class="form-input" placeholder="ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ì„¸ìš”." required></textarea>
      </div>

      <div class="form-group">
        <label for="tags">ğŸ·ï¸ íƒœê·¸</label>
        <input type="text" id="tags" name="tags" th:field="*{tags}"
               class="form-input" placeholder="#Java, #Spring, #React...">
      </div>

      <div class="form-group">
        <label for="thumbnail">ğŸ–¼ï¸ ì¸ë„¤ì¼ ì´ë¯¸ì§€</label>
        <div class="file-input-container">
          <input type="file" id="thumbnail" th:field="${postDTO.thumbnail}"
                 class="file-input" accept="image/*">
          <label for="thumbnail" class="file-label">
            ì¸ë„¤ì¼ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”
          </label>
        </div>
      </div>

      <div class="form-group">
        <label>ğŸ“ ì²¨ë¶€íŒŒì¼</label>
        <div id="fileInputs" class="file-inputs-container">
          <div class="file-input-container">
            <input type="file" id="attachments" name="attachments" class="file-input">
            <label for="attachments" class="file-label">
              íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”
            </label>
          </div>
        </div>
        <button type="button" class="add-file-btn" onclick="addFileInput()">
          â• íŒŒì¼ ì¶”ê°€
        </button>
      </div>

      <!-- ê¸°ì¡´ ì²¨ë¶€íŒŒì¼ í‘œì‹œ -->
      <div th:if="${postDTO.attachments != null}" class="form-group">
        <label>ğŸ“‹ ê¸°ì¡´ ì²¨ë¶€íŒŒì¼</label>
        <div class="existing-files">
          <div th:each="file : ${postDTO.attachments}" class="file-item">
            <a th:href="@{/files/{id}(id=${file.id})}"
               th:text="${file.originalFileName}"
               class="file-link">íŒŒì¼ëª…</a>
            <div class="delete-checkbox">
              <input type="checkbox" name="deleteFileIds" th:value="${file.id}" th:id="'delete-' + ${file.id}">
              <label th:for="'delete-' + ${file.id}">ğŸ—‘ï¸ ì‚­ì œ</label>
            </div>
          </div>
        </div>
      </div>

      <div class="submit-container">
        <button type="submit" class="submit-btn" id="submitBtn">
          <span th:text="${isEdit}? 'ìˆ˜ì •í•˜ê¸°' : 'ê²Œì‹œí•˜ê¸°'">ê²Œì‹œí•˜ê¸°</span>
        </button>
      </div>
    </form>
  </div>
</div>

<script th:if="${alertMessage}">
  alert('[[${alertMessage}]]');
</script>

<script>
  function addFileInput() {
    const container = document.getElementById("fileInputs");
    const fileInputDiv = document.createElement("div");
    fileInputDiv.className = "additional-file-input";

    const input = document.createElement("input");
    input.type = "file";
    input.name = "attachments";
    input.className = "file-input";

    const label = document.createElement("label");
    label.className = "file-label";
    label.textContent = "ì¶”ê°€ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”";
    label.style.cursor = "pointer";

    // ê³ ìœ  ID ìƒì„±
    const uniqueId = 'file-' + Date.now();
    input.id = uniqueId;
    label.setAttribute('for', uniqueId);

    const fileContainer = document.createElement("div");
    fileContainer.className = "file-input-container";
    fileContainer.appendChild(input);
    fileContainer.appendChild(label);

    fileInputDiv.appendChild(fileContainer);
    container.appendChild(fileInputDiv);

    // íŒŒì¼ ì„ íƒ ì‹œ ë ˆì´ë¸” ì—…ë°ì´íŠ¸
    input.addEventListener('change', function() {
      if (this.files && this.files[0]) {
        label.textContent = 'ğŸ“ ' + this.files[0].name;
        label.style.color = '#667eea';
      }
    });
  }

  // ê¸°ì¡´ íŒŒì¼ ì…ë ¥ì—ë„ ë™ì¼í•œ ê¸°ëŠ¥ ì¶”ê°€
  document.addEventListener('DOMContentLoaded', function() {
    const fileInputs = document.querySelectorAll('input[type="file"]');
    fileInputs.forEach(input => {
      input.addEventListener('change', function() {
        const label = document.querySelector(`label[for="${this.id}"]`);
        if (label && this.files && this.files[0]) {
          if (this.id === 'thumbnail') {
            label.textContent = 'ğŸ–¼ï¸ ' + this.files[0].name;
          } else {
            label.textContent = 'ğŸ“ ' + this.files[0].name;
          }
          label.style.color = '#667eea';
        }
      });
    });

    // í¼ ì œì¶œ ì‹œ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜
    const form = document.getElementById('postForm');
    const submitBtn = document.getElementById('submitBtn');

    form.addEventListener('submit', function() {
      submitBtn.classList.add('loading');
      submitBtn.disabled = true;
      submitBtn.innerHTML = 'ì²˜ë¦¬ì¤‘...';
    });
  });
</script>
</body>
</html>
